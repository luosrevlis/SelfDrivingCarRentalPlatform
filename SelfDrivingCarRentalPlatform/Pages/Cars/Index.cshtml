@page
@model Cars.IndexModel

@{
    ViewData["Title"] = "Index";
    string? userId = User.FindFirst("Id")?.Value;
}

<h1>Index</h1>

<p>
    <a asp-page="Create">Create New</a>
</p>
<head>
    <style>
        /* Style for form container */
        .form-container {
            width: 400px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        /* Style for form labels */
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* Style for form inputs */
        input[type="datetime-local"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
            box-sizing: border-box;
        }

        /* Style for checkbox container */
        .checkbox-container {
            margin-bottom: 10px;
        }

        /* Style for submit button */
        button[type="submit"] {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

            /* Style for submit button on hover */
            button[type="submit"]:hover {
                background-color: #45a049;
            }
    </style>
</head>
<form method="post">
    <div>
        <label asp-for="StartTime">Start Time</label>
        <input type="datetime-local" asp-for="StartTime" name="startTime" asp-format="{0:yyyy-MM-ddTHH:mm}">
    </div>

    <div>
        <label asp-for="EndTime">End Time</label>
        <input type="datetime-local" asp-for="EndTime" name="endTime" asp-format="{0:yyyy-MM-ddTHH:mm}">
    </div>
    <div>
        <label asp-for="MinPrice">Minimum Price</label>
        <input type="number" id="MinPrice" name="MinPrice" asp-for="MinPrice" step="0.01" min="0">
    </div>

    <div>
        <label asp-for="MaxPrice">Maximum Price</label>
        <input type="number" id="MaxPrice" name="MaxPrice" asp-for="MaxPrice" step="0.01" min="0">
    </div>
    <div class="form-group">
        <label asp-for="BrandId" class="control-label">Brand</label>
        <select asp-for="BrandId" class="form-control" asp-items="ViewBag.BrandId">
            <option value="0">All Brands</option>
        </select>
    </div>
    <div class="form-group">
        <label asp-for="TypeId" class="control-label">Car Type</label>
        <select asp-for="TypeId" class="form-control" asp-items="ViewBag.TypeId">
            <option value="0">All Types</option>
        </select>
    </div>
    <div>
        <input type="checkbox" asp-for="IsElectric" />
        <label asp-for="IsElectric">Electric Cars Only</label>
    </div>

    <div>
        <input type="checkbox" asp-for="NoMortgageRequired" />
        <label asp-for="NoMortgageRequired">No Mortgage Required</label>
    </div>
    <button type="submit">Filter</button>
</form>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].PlateNumber)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].CarRegisterNumber)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].PricePerDay)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].IsElectric)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].IsMortgageRequired)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].Status)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].IsDeleted)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].CarOwner)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].CarType)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CarList[0].CarBrand)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.CarList)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.PlateNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CarRegisterNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.PricePerDay)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.IsElectric)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.IsMortgageRequired)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Status)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.IsDeleted)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CarOwner.Email)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CarType.TypeName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CarBrand.BrandName)
                </td>
                <td>
                    @if (userId != null)
                    {
                        <a 
                            asp-page="../Contracts/RentCar"
                            asp-route-carid="@item.Id"
                            asp-route-rentstartdate="@Model.StartTime"
                            asp-route-rentenddate="@Model.EndTime"
                            class="btn btn-primary"
                        >
                            Rent
                        </a>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
@if (Model.ErrorMsg != null)
{
    <p class="text-danger">@Model.ErrorMsg</p>
}
